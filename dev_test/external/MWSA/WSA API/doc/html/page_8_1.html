<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Moody's SAV"/>
<title>WSA API REFERENCE GUIDE: Open deal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="http://www.moodys.com/index.html">
	 <img alt="Logo" src="project_logo.JPG"/>
	</a>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">WSA API REFERENCE GUIDE
   &#160;<span id="projectnumber">4.0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_8_1.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Open deal </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="open_sfw_cdo_deal"></a>
Open a CDOnet or SFW deal</h1>
<p>Both CDOnet and SFW deal files ends with "SFW" extension, i.e "1776.SFW","BAM04003.SFW". </p>
<h2>Procedure</h2>
<ul>
<li>call <a class="el" href="ccmo_8h.html#a2da9487ad083f0bab496f9b9afe8850f">set_input_path()</a> to notify API where to look deal files</li>
<li>create a null pointer and call <a class="el" href="ccmo_8h.html#ab025128aaeab8b60287f9737042a0b23">create_deal_scenario_object()</a> to initilize it</li>
<li>create a <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html" title="This is the primary structure used to pass information to and from the WSA API. ">CMO_STRUCT</a> and assign a deal id(or a CUSIP/ISIN) to <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">CMO_STRUCT::dealid</a>, suggesting which deal to open</li>
<li>call <a class="el" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex()</a></li>
</ul>
<h3>Sample code</h3>
<div class="fragment"><div class="line">*  #include &lt;stdio.h&gt;</div>
<div class="line">*  #include <span class="stringliteral">&quot;wsa.h&quot;</span></div>
<div class="line">*  </div>
<div class="line">*  <span class="keywordtype">int</span> main()</div>
<div class="line">*  {</div>
<div class="line">*   <span class="comment">// Set the path where deals located, make sure there is &quot;WSA_API.DB&quot; database in this folder as well.</span></div>
<div class="line">*   <span class="keyword">const</span> <span class="keywordtype">char</span> input_path[] = <span class="stringliteral">&quot;C:\\Run.Bin&quot;</span>;</div>
<div class="line">*   <span class="comment">// Tell API where to load deal files </span></div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a2da9487ad083f0bab496f9b9afe8850f">set_input_path</a>(input_path);</div>
<div class="line">*   <span class="comment">// initialize a identifier for open a deal </span></div>
<div class="line">*   <span class="keywordtype">void</span>* tid(NULL);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#ab025128aaeab8b60287f9737042a0b23">create_deal_scenario_object</a>(&amp;tid, NULL, NULL,<span class="keyword">false</span>);</div>
<div class="line">*   <span class="comment">// create a CMO_STRUCT to hold deal information</span></div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// specify the deal name to a char array</span></div>
<div class="line">*   <span class="keywordtype">char</span> deal_id[] = <span class="stringliteral">&quot;BAM04003&quot;</span>;    <span class="comment">// also can be a CUSIP/ISIN, e.g. &quot;31364JMQ3&quot;(CHS), &quot;3128PS5H6&quot;(AGENCY POOL), &quot;000759BP4&quot;(SFW), &quot;36230RNB8&quot;(HECM POOL), &quot;00969QAJ0&quot;(CDOnet), &quot;US000780BW56&quot;(SFW), &quot;XS0333236890&quot;(CDOnet)</span></div>
<div class="line">*   <span class="comment">// get length of deal name</span></div>
<div class="line">*   <span class="keywordtype">int</span> len = <span class="keyword">sizeof</span>(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>) / <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);</div>
<div class="line">*   <span class="comment">// assign deal name to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,deal_id,len-1);</div>
<div class="line">*   <span class="comment">// open a deal , populate info to CMO_STRUCT and tid</span></div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   <span class="comment">// after a deal opened, user can get which type deal it is.</span></div>
<div class="line">*   <a class="code" href="wsa_8h.html#a69770a6b4d5b221b2cfb46bf41bd2d48">ENGINE_TYPE</a> current_engine = <a class="code" href="wsa_8h.html#ad3926ba996e20aa92549481fffa233f7">get_current_deal_engine</a>(tid);</div>
<div class="line">*   <span class="comment">// 0 for CHS deal;1 stands for SFW deal;2 for CDOnet deal, please refer to enum type &quot;ENGINE_TYPE&quot;</span></div>
<div class="line">*   printf(<span class="stringliteral">&quot;Current open deal with %d \n&quot;</span>, current_engine);</div>
<div class="line">*   <span class="comment">// create a MARKIT_DEAL_INFO structure </span></div>
<div class="line">*   <a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html">MARKIT_DEAL_INFO</a> deal_info;</div>
<div class="line">*   <span class="comment">// retrieve deal information and store them in MARKIT_DEAL_INFO instance</span></div>
<div class="line">*   <span class="keywordtype">int</span> ret = <a class="code" href="ccmo_8h.html#a6be7da9f9ccb6c4b606c916a0ad095c5">get_deal_info</a>(tid, NULL, &amp;deal_info);</div>
<div class="line">*   <span class="comment">// if ret is less than 0, user shall check the error message throw by get_deal_error_msg()</span></div>
<div class="line">*   <span class="keywordflow">if</span>(ret &lt; 0)</div>
<div class="line">*       printf(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="ccmo_8h.html#a167078d11a7d4e91373611a29e2a21b4">get_deal_error_msg</a>(tid)); </div>
<div class="line">*   <span class="keywordflow">else</span></div>
<div class="line">*       <span class="comment">//print deal information</span></div>
<div class="line">*       printf(<span class="stringliteral">&quot;deal %s opened , it has %d bonds and %d collaterals \n&quot;</span>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#a57b4dafb89629992d81697265dad4d99">deal_name</a>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#a063e4309326836abc1df9e5cc95d2a26">num_bonds</a>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#aaccf0d915bf0e70e73bd9a641f3c9de6">num_colls</a>);</div>
<div class="line">*   <span class="comment">// close deal by calling close_deal_ex()</span></div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9a4fa1bf638cb2504b6d575bfdfa3045">close_deal_ex</a>(tid,pCmo);</div>
<div class="line">*   <span class="comment">// release tid</span></div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a43485c7beba00b3d8bd349537d75cd32">release_deal_scenario_object</a>(&amp;tid);</div>
<div class="line">*   <span class="keywordflow">return</span> 0;</div>
<div class="line">*  }</div>
<div class="line">* </div>
</div><!-- fragment --><p><br/>
</p>
<h2><a class="anchor" id="open_settlement_date"></a>
Open a deal with settlement date</h2>
<p>A SFW/CDOnet deal file may contain several deal updates. API will choose one of updates to open based on following rules:</p>
<p>if deal opened with <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">CMO_STRUCT::settlement_date</a> set to NULL (no settlement date): <br/>
</p>
<ul>
<li>API will choose the latest deal update in the deal file.</li>
</ul>
<p>if <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">CMO_STRUCT::settlement_date</a> is newer than any deal update in the deal file:<br/>
</p>
<ul>
<li>API will choose the latest deal update available in the deal file to open.</li>
</ul>
<p>if <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">CMO_STRUCT::settlement_date</a> is older than any deal update in the deal file:<br/>
</p>
<ul>
<li>API will choose the oldest deal update available in the deal file to open.</li>
</ul>
<p>if <a class="el" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">CMO_STRUCT::settlement_date</a> is between the range of deal update in the deal file:<br/>
</p>
<ul>
<li>API will choose the deal update whose update date is closest settlement date.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If there are more than one updates in a month, select the latest one.</dd></dl>
<hr/>
 <h1><a class="anchor" id="open_agency_deal"></a>
Open an agency deal.</h1>
<p>Opening a agency deal is same way as opening a SFW/CDOnet deal. </p>
<h3>Sample code</h3>
<p>To open a CHS deal "02-073F.CHS", only need to use filename from *.CHS instead of *.SFW files. </p>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*      <span class="keywordtype">char</span> deal_id[] = <span class="stringliteral">&quot;02-073F&quot;</span>;</div>
<div class="line">*      <span class="keywordtype">int</span> len = <span class="keyword">sizeof</span>(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>) / <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);</div>
<div class="line">*      strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,deal_id,len-1); </div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">*  </div>
</div><!-- fragment --><p><br/>
</p>
<hr/>
 <h1><a class="anchor" id="open_agency_pool"></a>
Open an agency pool.</h1>
<p>Agency pool data resides in file "POOL_DATA_[yyyymm].LPD", opening an agency pool must specify settlement date. Make sure LPD file is in input path. <br/>
 i.e ,if user set settlement date "7/14/13",then API will look for "POOL_DATA_201307.LPD" in input path.</p>
<h3>Sample code</h3>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// assign CUSIP to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,<span class="stringliteral">&quot;3128HDWZ8&quot;</span>, 10);</div>
<div class="line">*   <span class="comment">// set settlement date(mm/dd/yy) for opening, API will look file POOL_DATA_YYYYMM.LPD according to settlement date :</span></div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;05/01/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">* </div>
</div><!-- fragment --><p> Or: </p>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// assign &quot;AGENCY&quot; to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,<span class="stringliteral">&quot;AGENCY&quot;</span>, 6);</div>
<div class="line">*   <span class="comment">// assign &quot;POOL&quot; to CMO_STRUCT::bondid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a560f7ca59ff7d979abccc00295c568b8">bondid</a>,<span class="stringliteral">&quot;POOL&quot;</span>, 4);</div>
<div class="line">*   <span class="comment">// assign CUSIP to CMO_STRUCT::bond.cusip</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a3dda3f94cb0777b962cf9551bbbbc497">bond</a>.<a class="code" href="struct_c_c_m_o___b_o_n_d_s___s.html#a1b66a103960a50a66e2a93f071f639e0">cusip</a>,<span class="stringliteral">&quot;3128HDWZ8&quot;</span>, 9);</div>
<div class="line">*   <span class="comment">// set settlement date(mm/dd/yy) for opening, API will look file POOL_DATA_YYYYMM.LPD according to settlement date :</span></div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;05/01/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">* </div>
</div><!-- fragment --><p><br/>
</p>
<hr/>
 <h1><a class="anchor" id="open_hecm"></a>
Open a HECM pool</h1>
<p>HECM pools are in the datafile SFW_HECM_[YYYYMM].DB, opening a HECM pool must specify settlement date. Make sure DB file is in input path. <br/>
 i.e ,if user set settlement date "7/14/13",then API will look for "SFW_HECM_201307.DB" in input path.</p>
<h3>Sample code</h3>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// assign CUSIP to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,<span class="stringliteral">&quot;3620E1BG8&quot;</span>, 10);</div>
<div class="line">*   <span class="comment">// set settlement date(mm/dd/yy) for opening, API will look file SFW_HECM_YYYYMM.DB according to settlement date :</span></div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;06/07/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">*  }</div>
<div class="line">*  </div>
</div><!-- fragment --><p> Or: </p>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// assign &quot;SFW_HECM&quot; to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,<span class="stringliteral">&quot;SFW_HECM&quot;</span>, 8);</div>
<div class="line">*   <span class="comment">// assign &quot;POOL&quot; to CMO_STRUCT::bondid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a560f7ca59ff7d979abccc00295c568b8">bondid</a>,<span class="stringliteral">&quot;POOL&quot;</span>, 4);</div>
<div class="line">*   <span class="comment">// assign CUSIP to CMO_STRUCT::bond.cusip</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a3dda3f94cb0777b962cf9551bbbbc497">bond</a>.<a class="code" href="struct_c_c_m_o___b_o_n_d_s___s.html#a1b66a103960a50a66e2a93f071f639e0">cusip</a>,<span class="stringliteral">&quot;3620E1BG8&quot;</span>, 9);</div>
<div class="line">*   <span class="comment">// set settlement date(mm/dd/yy) for opening, API will look file SFW_HECM_YYYYMM.DB according to settlement date :</span></div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;06/07/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">*  }</div>
<div class="line">*  </div>
</div><!-- fragment --><p> <br/>
 </p>
<hr/>
 <h1><a class="anchor" id="open_cusip"></a>
Open with CUSIP</h1>
<p>If user don't know which deal corresponding to a given CUSIP, API provide a function <a class="el" href="wsa_8h.html#ac4d6ea00fe25efe34e353258f4c2fb1c">get_moodys_id()</a> enable user to get deal/bond from a CUSIP.</p>
<dl class="section warning"><dt>Warning</dt><dd>Since one bond could have multiple CUSIPs, but in API we only popluate one of them to <a class="el" href="struct_m_a_r_k_i_t___b_o_n_d___i_n_f_o.html#a75ff25a898d637e7b8509f561908ef59" title="CUSIP id. ">MARKIT_BOND_INFO.cusip</a> or <a class="el" href="struct_c_c_m_o___b_o_n_d_s___s.html#a1b66a103960a50a66e2a93f071f639e0" title="The CUSIP for the bond. ">CCMO_BONDS_S.cusip</a>. It is possible that user open a deal with CUSIP XXXXXXXXX, but the <a class="el" href="struct_m_a_r_k_i_t___b_o_n_d___i_n_f_o.html#a75ff25a898d637e7b8509f561908ef59" title="CUSIP id. ">MARKIT_BOND_INFO.cusip</a> and <a class="el" href="struct_c_c_m_o___b_o_n_d_s___s.html#a1b66a103960a50a66e2a93f071f639e0" title="The CUSIP for the bond. ">CCMO_BONDS_S.cusip</a> are populated by CUSIP YYYYYYYY.</dd></dl>
<h3>Sample code</h3>
<div class="fragment"><div class="line">*   ....</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   <span class="comment">// assign CUSIP to CMO_STRUCT::dealid</span></div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>,<span class="stringliteral">&quot;48124PAA2&quot;</span>, 10);</div>
<div class="line">*   <span class="comment">// set settlement date(mm/dd/yy) for opening, API will look file SFW_HECM_YYYYMM.DB according to settlement date :</span></div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;06/07/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   ....</div>
<div class="line">*  }</div>
<div class="line">*  </div>
</div><!-- fragment --><p> Or: </p>
<div class="fragment"><div class="line">*  #include &lt;stdio.h&gt;</div>
<div class="line">*  #include <span class="stringliteral">&quot;wsa.h&quot;</span></div>
<div class="line">* </div>
<div class="line">*  <span class="keywordtype">int</span> main()</div>
<div class="line">*  {</div>
<div class="line">*   <span class="keyword">const</span> <span class="keywordtype">char</span> input_path[] = <span class="stringliteral">&quot;C:\\Run.Bin&quot;</span>;</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a2da9487ad083f0bab496f9b9afe8850f">set_input_path</a>(input_path);</div>
<div class="line">*   <span class="keywordtype">void</span>* tid(NULL);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#ab025128aaeab8b60287f9737042a0b23">create_deal_scenario_object</a>(&amp;tid, NULL, NULL,<span class="keyword">false</span>);</div>
<div class="line">*   <span class="comment">// Given CUSIP:&quot;48124PAA2&quot;</span></div>
<div class="line">*   <span class="keyword">const</span> <span class="keywordtype">char</span> cuisp[10] = <span class="stringliteral">&quot;48124PAA2&quot;</span>;</div>
<div class="line">*   <span class="keywordtype">char</span> deal_id[20]= <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">*   <span class="keywordtype">char</span> bond_id[20]= <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">*   <span class="keywordtype">char</span> error_message[30]= <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">*   <span class="comment">// call get_moodys_id() to get corresponding deal id and bond id</span></div>
<div class="line">*   <span class="comment">// for pools ,deal_id will be either &quot;AGENCY&quot; or &quot;SFW_HECM&quot;, and bond_id will be &quot;POOL&quot;</span></div>
<div class="line">*   <span class="comment">// for CDOnet/SFW deals, deal_id will be deal name and bond_id will be bond name.</span></div>
<div class="line">*   <span class="keywordflow">if</span> (<a class="code" href="wsa_8h.html#ac4d6ea00fe25efe34e353258f4c2fb1c">get_moodys_id</a>(cuisp,deal_id,<span class="keyword">sizeof</span>(deal_id),bond_id,<span class="keyword">sizeof</span>(bond_id),error_message,<span class="keyword">sizeof</span>(error_message))==1){</div>
<div class="line">*       printf(<span class="stringliteral">&quot;Retrieve DEAL/BOND successfully: deal:%s \n&quot;</span>,deal_id);</div>
<div class="line">*   }<span class="keywordflow">else</span>{</div>
<div class="line">*       printf(<span class="stringliteral">&quot;Fail to retrieve DEAL/BOND : message %s \n&quot;</span>,error_message);</div>
<div class="line">*   }</div>
<div class="line">*   <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*   strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a01c5eaff1227ade8809330e804edba14">dealid</a>, deal_id, <span class="keyword">sizeof</span>(deal_id));</div>
<div class="line">*   <span class="comment">// different open logic for &quot;POOL&quot; (SFW_HECM and Agency POOL)</span></div>
<div class="line">*   <span class="keywordflow">if</span> (!strncmp(bond_id,<span class="stringliteral">&quot;POOL&quot;</span>, <span class="keyword">sizeof</span>(bond_id))){</div>
<div class="line">*       strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a560f7ca59ff7d979abccc00295c568b8">bondid</a>, bond_id, <span class="keyword">sizeof</span>(bond_id));</div>
<div class="line">*       strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a3dda3f94cb0777b962cf9551bbbbc497">bond</a>.<a class="code" href="struct_c_c_m_o___b_o_n_d_s___s.html#a1b66a103960a50a66e2a93f071f639e0">cusip</a>,cuisp, <span class="keyword">sizeof</span>(cuisp));</div>
<div class="line">*   }</div>
<div class="line">*     strncpy_s(pCmo-&gt;<a class="code" href="struct_c_m_o___s_t_r_u_c_t.html#a19399bd919ce260471da370503a5c083">settlement_date</a>, <span class="stringliteral">&quot;06/07/14&quot;</span>, 8);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(tid, pCmo);</div>
<div class="line">*   <a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html">MARKIT_DEAL_INFO</a> deal_info;</div>
<div class="line">*   <span class="keywordtype">int</span> ret = <a class="code" href="ccmo_8h.html#a6be7da9f9ccb6c4b606c916a0ad095c5">get_deal_info</a>(tid, NULL, &amp;deal_info);</div>
<div class="line">*   <span class="keywordflow">if</span>(ret &lt; 0)</div>
<div class="line">*       printf(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="ccmo_8h.html#a167078d11a7d4e91373611a29e2a21b4">get_deal_error_msg</a>(tid)); </div>
<div class="line">*   <span class="keywordflow">else</span></div>
<div class="line">*       printf(<span class="stringliteral">&quot;deal %s opened , it has %d bonds and %d collaterals \n&quot;</span>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#a57b4dafb89629992d81697265dad4d99">deal_name</a>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#a063e4309326836abc1df9e5cc95d2a26">num_bonds</a>, deal_info.<a class="code" href="struct_m_a_r_k_i_t___d_e_a_l___i_n_f_o.html#aaccf0d915bf0e70e73bd9a641f3c9de6">num_colls</a>);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a9a4fa1bf638cb2504b6d575bfdfa3045">close_deal_ex</a>(tid,pCmo);</div>
<div class="line">*   <a class="code" href="ccmo_8h.html#a43485c7beba00b3d8bd349537d75cd32">release_deal_scenario_object</a>(&amp;tid);</div>
<div class="line">*   <span class="keywordflow">return</span> 0;</div>
<div class="line">*  }</div>
<div class="line">*  </div>
<div class="line">*  </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="page_8.html">Tutorial</a></li>
    <li class="footer">Generated on Wed May 22 2019 21:18:34 for WSA API REFERENCE GUIDE by
    <a href="http://www.moodysanalytics.com/">
   Moody's Analytics SAV</a> </li>
  </ul>
</div>
</body>
</html>
