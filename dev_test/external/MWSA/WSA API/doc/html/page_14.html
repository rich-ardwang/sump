<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Moody's SAV"/>
<title>WSA API REFERENCE GUIDE: Market Risk Metrics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="http://www.moodys.com/index.html">
	 <img alt="Logo" src="project_logo.JPG"/>
	</a>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">WSA API REFERENCE GUIDE
   &#160;<span id="projectnumber">4.0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_14.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Market Risk Metrics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_14_0"></a>
Overview</h1>
<p>Since API 3.3.0, the Market Risk Metrics module has been enabled for all asset types and bank loans, which provides static and option-adjusted market risk measures through independent function calls. </p>
<h1><a class="anchor" id="sec_14_1"></a>
Static Market Risk Metrics</h1>
<p>Available metrics are: i-spread, z-spread, DV01, Macaulay duration, effective yield, yield-to-worst, yield value of the 32nd, spread convexity and the annualized measures. </p>
<h2><a class="anchor" id="sec_14_1_0"></a>
Step1: Set Reference Index Rate</h2>
<p>To calculate spreads and spread related metrics such as i-spread and z-spread, user is required to set the reference curve(s) by calling <a class="el" href="wsa_8h.html#aa3ef791490bff3964f6213bd25da607b">set_index_rate()</a> or equivalent functions. For example:</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <span class="comment">// open deal</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#a9fec86c2764699a30bc1f0d93d990e6a">open_deal_ex</a>(pDeal, pCmo);</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// call set_index_rate to set reference index rate</span></div>
<div class="line">*    <span class="keywordtype">short</span> index = <a class="code" href="indextypes_8h.html#a441ce8b836a671476ecb95fbb95cb60cad76670afc92bd6bab108e723d8b7a0cd">LIBOR_3</a>;</div>
<div class="line">*    <span class="keywordtype">double</span> rate = 0.028;</div>
<div class="line">*    <a class="code" href="wsa_8h.html#aa3ef791490bff3964f6213bd25da607b">set_index_rate</a>(pDeal, <span class="stringliteral">&quot;USD&quot;</span>, &amp;index, 0, &amp;rate);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h2><a class="anchor" id="sec_14_1_1"></a>
Step2: Set Static Market Risk Metrics Input</h2>
<p>Besides the reference rate curves, user may refer to structure <a class="el" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t.html" title="This structure stores inputs information for metrics calculation. ">METRIC_INPUT_STRUCT</a> which stores inputs for static metrics calculation. <br/>
 User may set clean_price value and APPLY_SPREAD_TYPE(LIBOR or TSY) as follows:</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t.html">METRIC_INPUT_STRUCT</a>  metric_input;</div>
<div class="line">*    </div>
<div class="line">*    metric_input.<a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t.html#a29e422cfa3adc661f230895c8bb607e9">clean_price</a> = 100.0;</div>
<div class="line">*    metric_input.<a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t.html#ab3b96112003722848a46986c78b2df6b">apply_spread_to</a> = <a class="code" href="wsa_8h.html#affaa3474d337582fb2f7a0e0c278aab6ac6e0c1aa87ce438c3547805a803ac938">APPLY_SPREAD_TO_LIBOR</a>;</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h2><a class="anchor" id="sec_14_1_2"></a>
Step3: Get Static Risk Measures Result</h2>
<p><a class="el" href="struct_m_e_t_r_i_c___r_e_s_u_l_t_s___s_t_r_u_c_t.html" title="This structure stores outputs results for metrics calculation. ">METRIC_RESULTS_STRUCT</a> stores static risk metrics that can be retrieved by calling <a class="el" href="wsa_8h.html#a63114c2ebaa20112ecacfb9c50c31f5b">get_bond_market_risk_metrics()</a> or <a class="el" href="wsa_8h.html#adaf512ef62f5f7112408aafda7a25108">get_loan_market_risk_metrics()</a> after the deal is run.</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_m_e_t_r_i_c___r_e_s_u_l_t_s___s_t_r_u_c_t.html">METRIC_RESULTS_STRUCT</a> results_m;</div>
<div class="line">*    <a class="code" href="wsa_8h.html#a63114c2ebaa20112ecacfb9c50c31f5b">get_bond_market_risk_metrics</a>(tid, bondId, &amp;metric_input, &amp;results_m);</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#a9a4fa1bf638cb2504b6d575bfdfa3045">close_deal_ex</a>(pDeal, pCmo);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h1><a class="anchor" id="sec_14_2"></a>
Option-Adjusted Market Risk Metrics</h1>
<p>Available metrics are: option-adjusted spread (OAS), effective duration spot, effective duration par, effective convexity spot, effective convexity par, spread duration.</p>
<h2><a class="anchor" id="sec_14_2_0"></a>
Pre-Step1 for Bankloan only: Set bank loan call model parameters</h2>
<p>Bank Loan Call Model was developed and implemented to simulate a bank loan’s call behavior with integration of ESG credit spread simulation model. <br/>
 Certain parameters are needed to be set by calling <a class="el" href="wsa_8h.html#a864f1da03bb5d5324c791ffd2d97aae5">set_bankloan_call_adj_param()</a>. WSAAPI provides recommended settings for bankloans.</p>
<h2><a class="anchor" id="sec_14_2_1"></a>
Pre-Step2 for Bankloan only: Set simulated credit spreads</h2>
<p>Credit Spread simulation of different credit ratings &amp; terms is necessary for bank loan call model. User-specified simulated bankloan credit spreads can be set by calling <a class="el" href="wsa_8h.html#a4455b87f07f49e9c631d966b98c55c7c">set_spot_spread()</a>. <br/>
 WSAAPI is also integrated with ESG’s credit spread simulation, which needs to be triggered by calling <a class="el" href="wsa_8h.html#adad4da73f0f7f61952419454d0579c2d">set_up_ESG_model_interest_rates()</a> with ESG_MODEL_INPUTS::ESG_RATE_TYPE being set to SPOT_SPREAD_RATE. <br/>
 WSAAPI can provide the necessary implementation logic and adjustment for bankloans.</p>
<h2><a class="anchor" id="sec_14_2_2"></a>
Step1: Set ESG simulated index rates (optional)</h2>
<p>API is integrated with ESG's extended 2-Factor Black-Karasinski Model (WSAESGProvider.dll), which provides simulated LIBOR/SWAP and government curves of over 30 economies. <br/>
 User may set up this dynamic simulation process by specifying structure <a class="el" href="struct_e_s_g___m_o_d_e_l___i_n_p_u_t_s.html" title="This structure stores inputs to setup ESG model interest rates. ">ESG_MODEL_INPUTS</a> and calling function <a class="el" href="wsa_8h.html#adad4da73f0f7f61952419454d0579c2d">set_up_ESG_model_interest_rates()</a>. <br/>
 Alternatively, user may set the simulated interest rate paths generated by his/her own interest rate model as described in Step3 below.</p>
<h2><a class="anchor" id="sec_14_2_3"></a>
Step2: Set OAS-related Market Risk Metrics Input</h2>
<p><a class="el" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t___e_x.html" title="This structure stores inputs information for metrics ex calculation. ">METRIC_INPUT_STRUCT_EX</a> is the structure to hold inputs specifically for OAS-related analysis. <br/>
 User may specify simulation path number, OAS mode and interest rate shift amount using this structure, and call function <a class="el" href="wsa_8h.html#aa1ea6f0f702c446be8a813f975588253">set_metrics_input_ex()</a> to set the inputs into API.</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t___e_x.html">METRIC_INPUT_STRUCT_EX</a> metric_input_ex;</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// 100 paths for OAS analysis</span></div>
<div class="line">*    metric_input_ex.<a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t___e_x.html#a09909be8e90272f171d48bda4d8a3207">num_paths</a> = 100;</div>
<div class="line">*    <span class="comment">// enable calculation of all OAS-related metrics</span></div>
<div class="line">*    metric_input_ex.<a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t___e_x.html#a7f9a9939728fafed2a743698efc24576">oas_mode</a> = <a class="code" href="wsa_8h.html#a8b7538432953725ab0f8b07a96c155d1af15221bd6d11c344943f7f63717ea42b">ENABLE_ALL</a>;</div>
<div class="line">*    <span class="comment">// shift the reference curve up (down) by 100 basis points</span></div>
<div class="line">*    metric_input_ex.<a class="code" href="struct_m_e_t_r_i_c___i_n_p_u_t___s_t_r_u_c_t___e_x.html#ac10b6438f960474bec08758d91d5d215">shift_amt</a> = 0.01;</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="wsa_8h.html#aa1ea6f0f702c446be8a813f975588253">set_metrics_input_ex</a>(tid, &amp;metric_input_ex);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h2><a class="anchor" id="sec_14_2_4"></a>
Step3: Apply user-specified simulated interest rates (optional)</h2>
<p>User may choose to set his/her own interest rate paths for OAS analysis by calling function <a class="el" href="wsa_8h.html#af5a696c67f43f99a40f9226a399b2909">set_index_rate_ex()</a> after Step2. <br/>
 If neither Step1 nor Step3 is executed, the static interest rate path from function call <a class="el" href="wsa_8h.html#aa3ef791490bff3964f6213bd25da607b">set_index_rate()</a> or equivalent would be applied to all paths for OAS analysis. </p>
<h2><a class="anchor" id="sec_14_2_5"></a>
Step4: Get OAS-related Risk Measures Result</h2>
<p><a class="el" href="struct_m_e_t_r_i_c___r_e_s_u_l_t_s___s_t_r_u_c_t___e_x.html" title="This structure stores metircs results information. ">METRIC_RESULTS_STRUCT_EX</a> stores results of OAS related simulation risk measures, which can be retrieved by calling <a class="el" href="wsa_8h.html#a15da1cabb4ee307e66d847317b3de60d">get_bond_market_risk_metrics_ex()</a> or <a class="el" href="wsa_8h.html#a7697deab0d0dc2619e50d5f567eca7f6">get_loan_market_risk_metrics_ex()</a>. <br/>
 In addition to the inputs detailed in the above section that generally apply to the entire waterfall model, user is required to set three more parameters for the requested tranche or bankloan: <br/>
 APPLY_SPREAD_TYPE, METRIC_ANCHORS (OAS or MARKET_PRICE) and anchor_value.</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_m_e_t_r_i_c___r_e_s_u_l_t_s___s_t_r_u_c_t___e_x.html">METRIC_RESULTS_STRUCT_EX</a> results_ex;</div>
<div class="line">*    <a class="code" href="wsa_8h.html#a15da1cabb4ee307e66d847317b3de60d">get_bond_market_risk_metrics_ex</a>(tid, bondId, <a class="code" href="wsa_8h.html#aa16f125cb3399be6608c9fb04a0a3cb0abe76ae206d64fb3aa1c83aad666c1ee3">MARKET_PRICE</a>, 100.0, <a class="code" href="wsa_8h.html#affaa3474d337582fb2f7a0e0c278aab6ac6e0c1aa87ce438c3547805a803ac938">APPLY_SPREAD_TO_LIBOR</a>, &amp;results_ex);</div>
<div class="line">*    <span class="comment">// get_loan_market_risk_metrics_ex(tid, loan_num, MARKET_PRICE, 100.0, APPLY_SPREAD_TO_LIBOR, &amp;results_ex); //for bankloans</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#a9a4fa1bf638cb2504b6d575bfdfa3045">close_deal_ex</a>(pDeal, pCmo);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed May 22 2019 21:18:34 for WSA API REFERENCE GUIDE by
    <a href="http://www.moodysanalytics.com/">
   Moody's Analytics SAV</a> </li>
  </ul>
</div>
</body>
</html>
