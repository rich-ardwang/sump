<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Moody's SAV"/>
<title>WSA API REFERENCE GUIDE: Whole Loan Analyzer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="http://www.moodys.com/index.html">
	 <img alt="Logo" src="project_logo.JPG"/>
	</a>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">WSA API REFERENCE GUIDE
   &#160;<span id="projectnumber">4.0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_13.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Whole Loan Analyzer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_13_0"></a>
Overview</h1>
<p>Since WSAAPI v2.7, the whole loan analysis was introduced - Whole Loan Analyzer. <br/>
 By setting up loans in WSAAPI Whole Loan Analyzer, users can generate loan &amp; portfolio level cash flow, run credit model and price individual loans. <br/>
 Whole Loan Analyzer is powered by SFW engine, which is for most mortgage types, or CDONet engine, which is for bankloans.</p>
<h1><a class="anchor" id="sec_13_1"></a>
Steps for Whole Loan Analysis</h1>
<h2><a class="anchor" id="sec_13_1_1"></a>
Set whole loan</h2>
<p>By calling <a class="el" href="wsa_8h.html#afabd36bad3f0de86b5874650b1784f0a">set_whole_loan()</a>, loan tapes could be loaded into engine. <br/>
 Each valid loan would be allocated with a "loan_number" sequentially by the order in which the loans are supplied to the engine, starting from "1".</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <span class="keywordtype">void</span>* tid(NULL);</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// Set the path for &quot;WSA_API.DB&quot; and whole loan LIC.</span></div>
<div class="line">*    <span class="keyword">const</span> <span class="keywordtype">char</span> input_path[] = <span class="stringliteral">&quot;..\\Data\\&quot;</span>;</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#a2da9487ad083f0bab496f9b9afe8850f">set_input_path</a>(input_path);</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// Set the preferred engine for overlapping deals.</span></div>
<div class="line">*    <a class="code" href="wsa_8h.html#a9e7e4827be8b826e4893bf3b8c1361c2">set_engine_preference</a>(<a class="code" href="wsa_8h.html#ac912e01ca57dd58abfa1dd39451a26efaacae4b8acd0817c5dd5cbef6f9d41d53">PICK_SFW_ENGINE_FOR_MAPPED_DEALS</a>);</div>
<div class="line">*    <span class="comment">// Clean up temporary files</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#afc74e45a0dd1f5be58c7234d577f388c">set_tmp_dir_treatment</a>(<a class="code" href="ccmo_8h.html#af6917010b952d6a0ad22a58435f6d85cade366f2c361ce82caf5d66d2d99ceec2">TMP_DIR_REMOVE_ALL</a>);</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// Set the preferred engine for overlapping deals.</span></div>
<div class="line">*    <a class="code" href="wsa_8h.html#a9e7e4827be8b826e4893bf3b8c1361c2">set_engine_preference</a>(<a class="code" href="wsa_8h.html#ac912e01ca57dd58abfa1dd39451a26efaacae4b8acd0817c5dd5cbef6f9d41d53">PICK_SFW_ENGINE_FOR_MAPPED_DEALS</a>);</div>
<div class="line">*    vector&lt;WHOLE_LOAN_STRUCT&gt; loans;</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html">WHOLE_LOAN_STRUCT</a> loan;</div>
<div class="line">*    memset(&amp;loan, 0, <span class="keyword">sizeof</span>(loan));</div>
<div class="line">*     </div>
<div class="line">*    loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#ab445f9528ffae9642fc6c0b6cbf9f175">amortization_type</a> = <a class="code" href="wsa_8h.html#a3ce6aa44bf29be766ca7ffa88c6cab69aa9f6dd8ad4249c8d0661fac9d9131b47">ANN</a>;  <span class="comment">//amortization type</span></div>
<div class="line">*     </div>
<div class="line">*    loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#a22d21c4ab82a0a35b48d0e8b0cee5978">current_balance</a> = 10000;</div>
<div class="line">*    loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#a96ce3eee82015dacc9921ebc42c83157">term</a> = 12;</div>
<div class="line">*    loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#a5dc351a7f4a38074a02f3f20d1cb4f3c">original_term</a> = 360;</div>
<div class="line">*    strncpy_s(loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#a23eb2b9e67222248cd5c1cf146c884cd">currency</a>, <span class="stringliteral">&quot;USD&quot;</span>, 4);</div>
<div class="line">*    </div>
<div class="line">*    coupon info</div>
<div class="line">*    <a class="code" href="struct_c_o_u_p_o_n___i_n_f_o.html">COUPON_INFO</a>&amp; coupon_info = loan.<a class="code" href="struct_w_h_o_l_e___l_o_a_n___s_t_r_u_c_t.html#a883864d4ab2a8c55b8739697203459b5">coupon_info</a>;</div>
<div class="line">*    coupon_info.<a class="code" href="struct_c_o_u_p_o_n___i_n_f_o.html#a737699ff037c39521b51e4e85c650371">coupon_type</a> = </div>
<div class="line">*    <a class="code" href="wsa_8h.html#a135231401b851695c9425489522cb499af42fd94b4ead7d21f81517994ba34bc1">WHOLE_LOAN_COUPON_TYPE::FIXED_COUPON</a>;</div>
<div class="line">*    coupon_info.gross_coupon = 0.05;</div>
<div class="line">*    coupon_info.net_coupon = 0.05;</div>
<div class="line">*    coupon_info.day_count = <a class="code" href="ccmo_8h.html#a73516fd1f78109e4ecb6221af9401ed0">DAYCOUNT_30_360</a>;</div>
<div class="line">*    coupon_info.pay_freq = <a class="code" href="wsa_8h.html#aa80a0a7333a980e62fb9bc3693def427a0dc90afeb45c4d51475e738b68054a4a">PAYMENT_FREQUENCY::PAY_FREQ_MONTHLY</a>;</div>
<div class="line">*    </div>
<div class="line">*    loans.push_back(loan);</div>
<div class="line">*    </div>
<div class="line">*    <span class="keyword">const</span> <span class="keywordtype">int</span> settlementdate = 20160201;</div>
<div class="line">*    <a class="code" href="wsa_8h.html#afabd36bad3f0de86b5874650b1784f0a">set_whole_loan</a>(tid, &amp;loans.front(), loans.size(), settlementdate);</div>
<div class="line">*    </div>
<div class="line">*    <span class="comment">// set calc level to enable loan cashflow</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#ac0ec4af4fde997cf7a5e55b2b324f5fa">set_deal_calc_level</a>(tid, <a class="code" href="ccmo_8h.html#af3fe49cb2524fbf600ef8a4149527c25a61ebed419ac994d2318b3e522cc5c45e">CALC_LEVEL_FULL_WITH_LOAN</a>, 1);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h2><a class="anchor" id="sec_13_1_2"></a>
Get cash flow and pricing results</h2>
<h3><a class="anchor" id="sec_13_1_2_0"></a>
Portfolio cash flow</h3>
<p>Retrieving portfolio level cashflow in Whole Loan Analyzer is pretty similar to the way of running regular deals. Please refer category index 12.1.1 - "Collateral cashflow" for details. </p>
<h3><a class="anchor" id="sec_11_1_2_1"></a>
Loan level cash flow</h3>
<p>There are 2 ways to retrieve loan level cashflow - either by calling <a class="el" href="wsa_8h.html#ad448daac60d02fb2efca7952f3cec9cb">get_loan_flow_ex()</a> to populate structure <a class="el" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html" title="This structure is used to provide user with loan cashflow. It includes number of cashflow points as w...">MOODYS_LOAN_CASHFLOW</a> or by calling <a class="el" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow()</a> to get a single flow. <br/>
 Loan level cashflow is only retrievable when deal_calc_level is set to CALC_LEVEL_FULL_WITH_LOAN.</p>
<p><a class="el" href="wsa_8h.html#ad448daac60d02fb2efca7952f3cec9cb">get_loan_flow_ex()</a>: <br/>
 <a class="el" href="wsa_8h.html#ad448daac60d02fb2efca7952f3cec9cb">get_loan_flow_ex()</a> is recommended to be used if users would like to get a set of a loan's cashflow by calling API function once.</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <span class="comment">// set calc level to enable loan cashflow</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#ac0ec4af4fde997cf7a5e55b2b324f5fa">set_deal_calc_level</a>(tid, <a class="code" href="ccmo_8h.html#af3fe49cb2524fbf600ef8a4149527c25a61ebed419ac994d2318b3e522cc5c45e">CALC_LEVEL_FULL_WITH_LOAN</a>, 1);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html">MOODYS_LOAN_CASHFLOW</a> * pMLC = <span class="keyword">new</span> <a class="code" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html">MOODYS_LOAN_CASHFLOW</a>();</div>
<div class="line">*    <a class="code" href="wsa_8h.html#ad448daac60d02fb2efca7952f3cec9cb">get_loan_flow_ex</a>(tid, 1, pMLC);</div>
<div class="line">*    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0;j &lt; pMLC-&gt;<a class="code" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html#ac8b93b18259baac8737db86a4761ff1a">size</a>;j++)</div>
<div class="line">*    {</div>
<div class="line">*        printf(<span class="stringliteral">&quot;%d,%f\n&quot;</span>, pMLC-&gt;<a class="code" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html#a8f35c3e2d4acf9bfe0a2d1f44cc56403">dates</a>[j], pMLC-&gt;<a class="code" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html#ac6fb225ce1497e1461d14e588d9b3371">balance</a>[j]);</div>
<div class="line">*    }</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><p><a class="el" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow()</a>: <br/>
 <a class="el" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html" title="This structure is used to provide user with loan cashflow. It includes number of cashflow points as w...">MOODYS_LOAN_CASHFLOW</a> only provides a limit number of cashflows. WSAAPI Whole Loan Analyzer also provides <a class="el" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow()</a> to offer more loan flows. <br/>
 <a class="el" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow()</a> is recommended to be used if users would like to retrieve cashflows that wasn't included in <a class="el" href="struct_m_o_o_d_y_s___l_o_a_n___c_a_s_h_f_l_o_w.html" title="This structure is used to provide user with loan cashflow. It includes number of cashflow points as w...">MOODYS_LOAN_CASHFLOW</a>. <br/>
 Note: Full list of available identifier ( some may not available in Whole Loan Analyzer ): EXTENDED_FLOW_COLLATERAL_IDENTIFIER</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <span class="comment">// set calc level to enable loan cashflow</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#ac0ec4af4fde997cf7a5e55b2b324f5fa">set_deal_calc_level</a>(tid, <a class="code" href="ccmo_8h.html#af3fe49cb2524fbf600ef8a4149527c25a61ebed419ac994d2318b3e522cc5c45e">CALC_LEVEL_FULL_WITH_LOAN</a>, 1);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*     </div>
<div class="line">*    <span class="keywordtype">double</span>* loan_cf_balance = <a class="code" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow</a>(tid, 1, NULL, <a class="code" href="ccmo_8h.html#ad16bb3760880aef1036a60491d871577a356622c892d4c2cc8b7e6168e0ee919c">FLOW_COLLATERAL_BALANCE</a>); </div>
<div class="line">*    <span class="keywordtype">double</span>* loan_cf_cash = <a class="code" href="wsa_8h.html#a4af4eb4d2d30f77736a0d0bb9d80f763">get_loan_flow</a>(tid, 1, NULL, <a class="code" href="ccmo_8h.html#ad16bb3760880aef1036a60491d871577a67028724502510b279b95351ce7c839c">FLOW_COLLATERAL_CASH</a>);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --><h3><a class="anchor" id="sec_11_1_2_2"></a>
Retrieve pricing results</h3>
<p>WSAAPI Whole Loan Analyzer supports cashflow analytics for a given loan. <br/>
 Loan pricing functionality is only available after running cashflow, with deal_calc_level being set to CALC_LEVEL_FULL_WITH_LOAN.</p>
<div class="fragment"><div class="line">*  ...</div>
<div class="line">*    <span class="comment">// set calc level to enable loan cashflow</span></div>
<div class="line">*    <a class="code" href="ccmo_8h.html#ac0ec4af4fde997cf7a5e55b2b324f5fa">set_deal_calc_level</a>(tid, <a class="code" href="ccmo_8h.html#af3fe49cb2524fbf600ef8a4149527c25a61ebed419ac994d2318b3e522cc5c45e">CALC_LEVEL_FULL_WITH_LOAN</a>, 1);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a> *pCmo = <span class="keyword">new</span> <a class="code" href="struct_c_m_o___s_t_r_u_c_t.html">CMO_STRUCT</a>();</div>
<div class="line">*    <a class="code" href="ccmo_8h.html#acf68ddb88ebae9fd26d06458f408848e">run_deal_ex</a>(tid, pCmo);</div>
<div class="line">*    </div>
<div class="line">*    <a class="code" href="struct_p_r_i_c_i_n_g___r_e_s_u_l_t_s.html">PRICING_RESULTS</a>* pr = <span class="keyword">new</span> <a class="code" href="struct_p_r_i_c_i_n_g___r_e_s_u_l_t_s.html">PRICING_RESULTS</a>();</div>
<div class="line">*    <a class="code" href="wsa_8h.html#a42d01ee7572d03d6afbd3f525262cd07">price_loan</a>(tid, 1, <a class="code" href="ccmo_8h.html#af7227b182ee64cfb7d649a30a8f16249ae41f8c159d4b4a027f86f32d112a94bd">PRICE</a>, 100, pr);</div>
<div class="line">*  ...</div>
<div class="line">*  </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed May 22 2019 21:18:34 for WSA API REFERENCE GUIDE by
    <a href="http://www.moodysanalytics.com/">
   Moody's Analytics SAV</a> </li>
  </ul>
</div>
</body>
</html>
